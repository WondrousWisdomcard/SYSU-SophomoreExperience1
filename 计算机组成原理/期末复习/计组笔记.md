### 附录1、存储器

#### 知识点1、存储器分类

1. 随机存储器
    1.1. 双极型半导体存储器Cache
    1.2. MOS型半导体存储器RAN
        1.2.1 SRAM (Static)
        1.2.2 DRAM (Dynamic)
            1.2.2.1 SDRAM (Synchronized DRAM)
            1.2.2.2 DDR SDRAM (Double Dtat-Rate SDRAM)
2. 只读存储器 ROM
    2.1. PROM 可编程
    2.2. EPROM 可擦除可编程
3. 电可擦除存储器 
    3.1. EEPROM
    3.2. FLASH MEMORY 闪存

#### 知识点2、 存储系统的层次结构

CPU内部寄存器 - 多级缓存Cache - 主存 - 辅助存储器（硬盘 磁盘 磁带 U盘）

工作速度 快->慢 存储容量 小->大

#### 知识点3、存储器组成部分

地址寄存器 译码器 读写控制器 数据缓冲器 时序控制器

#### 知识点4、SRAM和DRAM基本概念

SRAM原理：使用双稳态电路存储信息，**锁存器**

**Remark 三态门高电平打开，低电平高阻抗断开** 

DRAM原理：**电容**的充电和放电。

DRAM必须定时刷新；RAS(Row Address Select)信号选中行信号，CAS选中列信号，共用地址锁存器。

与SRAM相比，DRAM贵，快，容量小。

#### 知识点5、EPROM，EEPROM和Flash基本原理

EPROM原理：浮空多级硅栅，紫外线照射可以擦除内容（泄露电子）

EEPROM原理：采用第二级多晶硅（隧道二极管）和浮空多级硅栅，电子转移；可随机访问和修改单个字节，掉电以后数据不丢失（这也是**闪存**的原理）

### 附录2、输入输出接口

#### 知识点6、微型计算机结构图和概念

CPU包括控制器和运算器

PC总线是用于连接计算机内部的功能部件的一组**公共**信号线，有三种AB地址总线，DB数据总线，CB控制总线。总线连接CPU，I/O接口（I/O设备的接口）和存储器。

考虑8086标志寄存器中的内容，它们是根据运算结构而进行设置的。

#### 知识点7、IO端口地址译码原理

可以通过I/O指令来访问I/O端口，x86的I/O指令有 IN OUT 读取/写入端口地址的内容。

如何设计I/O端口地址译码电路？通过地址总线和控制总线产生端口新品的选择信号（CS）

端口地址译码的种类：采用门电路/译码器的固定式单端口地址译码；采用比较器/译码器的可选式端口地址译码

可以采用可编程逻辑阵列来实现逻辑电路，原理与EPROM相同

#### 知识点8、输入输出端口类种类

Remark 端口在接口（适配器）中，连接总线与外部设备
三态门输入端口与锁存型输入/输出端口

**三种端口类型：数据缓存器，状态端口，控制端口**

#### 知识点9、输入输出方法

输入输出方法（编程方法）：**查询方式，中断方式，DMA方式**

查询方式：死循环（有相应代码）执行读端口指令查询接口状态，一旦接口准备好就读写数据

中断方式：接口准备好后，向CPU发送请求（请求中断当前的程序转而为之服务）

DMA方式：请求DMA控制器接管总线，让控制外设与主存储器直接交换数据

### 附录3、中断系统

#### 知识点10、中断的概念

在程序运行过程中，出现了某种紧急状态，CPU必须中止现行程序，转而去处理此紧急事件（执行中断服务程序），并在处理完毕后后返回原运行程序的过程。

不同的中断类型：可屏蔽中断/不可屏蔽中断（对于可屏蔽中断，标志寄存器IF设置为1时表示允许中断），外部中断/内部中断

中断的全过程：**中断请求->中断判优->中断响应->中断处理->中断返回**

中断响应和处理的过程： 保存返回地址->保存现场->清除中断->...->恢复现场->中断返回

#### 知识点11、中断优先级和中断嵌套

针对多个中断出现的情况，CPU按照一定的优先级响应和处理中断。

**判断中断优先级的方法：软件查询法，菊花链（一种优先级排队电路），可编程中断控制器（一块芯片）**

软件查询法：将各个外设的中断请求信号相或，接收到信号后再遍历中断请求，再由中断处理程序决定优先级，节省硬件但响应较慢

中断嵌套：在执行较低级的中断处理时可以响应较高级的中断请求，而将当前中断暂时挂起。

#### 知识点12、微机系统的中断：8259A

8259A是一个管理中断请求的芯片，用来实时中断驱动微机系统，具有8个中断级别和中断请求，可级联。

**8259A的内部结构：连接外设与CPU接口，由中断请求寄存器IRR（接受并锁存中断请求信号），正在服务寄存器ISR（保存当前处理的中断请求），优先级裁决器RE（将中断请求寄存器中优先级最高的与正在服务中断优先级进行比较，若更高发出INT（中断请求）信号，优先级IR0最高,IR7最低），中断屏蔽寄存器IMR（8位），用来屏蔽8个中断请求信号。**

8259A基本工作步骤：
当请求信号出现，IRR重置->IMR决定是否屏蔽它->PR选择IR中最高的并于ISR中的比较，若更高则给CPU发出INT信号->CPU执行当前指令后且IF=1则发出俩INTA#信号来响应中断->8258A接受首个INTA#信号后将ISR相应位置置位，IRR相应位被置位->接受第二个INTA#信号后，8259A将中断的类型（中断向量的类型）通过数据总线传给CPU->AEOI模式下，再第二个信号结束时ISR相应位被复位，否则由中断服务程序发送EOI命令来复位。

8088CPU的中断过程：
CPU检测INTR=1->发出两INTA#->在第二个INTA#之后从数据总线读取中断向量->**自动关中断**IF=0，保存现场->把中断向量*4作为内存地址取出预先存放的中断服务程序的入口地址，置CS:IP,转入中断处理程序。

8259A的级联方式，将从8259A的INT连入主8259A的IR里去，并将器INTA连上主的CAS0-CAS2

8259A的编程方法：
ICW Initialization Command Word, OCW Operation Command Word
需要设置初始化命令字(启动系统时设定) ICW1 - ICW4（分别是触发/级联方式，设置中断向量类型，这是主从方式，设置嵌套和中断结束方式） 和工作命令字 OCW1 - OCW3（分别是中断屏蔽字，设置中断优先权方式，设置特殊屏蔽模式/查询命令

#### 知识点13、中断服务程序

中断服务程序的编写：
主程序：初始化接口->关中断CLI->设置中断向量指向中断服务程序入口地址->开中断->返回主程序
中断服务程序：**保存现场->开中断（SETI,IF=1，才能允许中断嵌套）->...->发送EOI命令，清除ISR响应位->恢复现场->中断返回（IRET）**

### 附录4、DMA

#### 知识点14、DMA的概念

直接存储器访问，直接将数据在外设和内存间互传，或者在内存直接传输

DMA控制器通过接管总线（总线窃取）来实现字节传送，传完后再把控制权交回给CPU

DMA传输过程：DMA请求（CPU对DMA控制器初始化并向I/O接口发送操作命令，I/O接口再提出DMA请求）->DAM响应->DMA传输（CPU即刻挂起只执行内部操作）->DMA结束（DMA释放总线控制权，向I/O接口发送结束信号。I/O结束工作并向CPU提出中断请求）

#### 知识点15、DMA控制器（DMAC）：8237A

**三种工作模式：单字节传送方式，数据块传送方式，请求传送方式**

8237A的周期：空闲周期(CPU可以写入参数)，有效周期（控制读写）

8237A的工作原理(指令)：

CPU-[HLDA]->8237A-[DACK]->I/O接口
I/O接口-[DREQ]->8237A-[HRQ]->CPU

(1)DMA控制器(DMAC)可以从CPU接管总线完成外设和内存之间的直接访问；
(2)**DMAC首先要编程设置本次DMA要访问内存块的字节数和基址**；
(3)每次外设准备好发送或接收数据，都会向DMAC发出DREQ信号；
(4)DMAC收到外设的DREQ信号后会向CPU发出HRQ信号请求接管总线；
(5)**CPU在每个总线周期结束时都会检查HRQ信号**；
(6)当该信号为高电平时，CPU会让出总线，并发出HLDA信号；
(7)在DMAC收到HLDA信号后接管总线，并向外设发出DACK信号;
(8)随后，DMAC会发出内存地址和控制信号MEMW#和IOR#;
(9)外设在控制信号IOR#和DACK的作用下，发送数据到数据总线;
(10)而内存在控制信号MEMW#的作用下根据地址总线上的地址把数据总线上的数据写入存储单元;
(11)**DMAC继续按上面步骤(8)-(10)发送下一个内存地址和控制信号，并把字节数减1**；
(12)**当字节数变为0时，DMAC会令HRQ信号无效的方式通知CPU接管总线**;
(13)**最后，DMAC还会发出EOP#信号。此信号可以用作中断请求信号**。

信号DMA存储器到存储器数据移动 8237A先给出源地址，发出MEMR#信号，将存储器的一个字节读入8237A的一个临时寄存器，然后给目标地址和发出MEMW#信号，把该字节内容写入存储器。源和目标分别采用通道0和通道1，采用软件DREQ#启动通道0，传送直到通道1的字节计数器减到零。

8237A内部有很多功能不同的寄存器，也可以有级连。

#### 知识点16、8237A的工作模式

单字节模式：HRQ有效时DMA传送，**每次只传送一个字节，便令HRQ失效**，将总线让给CPU。如果DREQ再次有效或者一直有效，8237A则再次发出HRQ

块传送模式：让DREQ启动，8237A占有总线后连续传送，直至**字节计数器减到零，释放总线**。

请求传送模式：只要DREQ有效就可以继续传送，**当DREQ无效时暂停传送，当DREQ有效时接着传送**，直至计数器减到零，停止传送。

### 附录5、总线

#### 知识点、17 总线周期

时钟周期<机器周期<指令周期 机器周期指的是完成执行指令的一个基本操作所需要的时间；

**总线周期指的是一次访问存储器或者I/O端口所要花费的时间。**

#### 知识点、18 ISA总线

ISA总线：工业标准架构总线

ISA总线的信号线分类：24位地址和16位数据线，周期控制线，总线控制线（时钟和复位线等），中断控制线，DMA控制线。

读懂ISA总线下周期时序图部分信号 

    ALE 地址锁存使能信号 
    IO/M# IO/内存选中信号
    DEN# 数据使能信号
    DT/R# 数据传输/接收信号
    AD 数据/地址复用线

EISA总线 Extended ISA 32位地址 16位数据线

#### 知识点、19 PCI总线

PCI总线是独立于CPU的系统总线，有中间缓冲器可将显卡，声卡等外围设备直接挂在CPU总线上。

南北桥集线器

读懂PCI总线下周期时序图部分信号 

    BE 字节使能信号
    IRDY 初始化Ready
    TRDY 目标Ready
    DEVSEL 设备选择信号

每个时钟周期上升沿完成一个32bits数据的传送，Frame#信号无效时再完成最后一个数据传送，传送过程结束

地址空间和突发访问

PCI地址空间：存储器地址空间，I/O地址空间，配置地址空间，后者用于取出插件板的配置信息。

总线控制命令BUS CMD

字节允许 BE#表示正在传送的四个字节哪几个有效。

AGP总线 AGP加速图形接口

#### 知识点、20 PCIe总线

PCLe PCL Express 第三代输入输出总线

PCLe优点：满足双向传输，无冲突；多通道，可扩展：采用电压差分信号传输（利用电压差）；简化主板设计，通用，模块化，实现节点和热插拔，能处理点到点的数据传输

PCLe工作原理：使用交换机Switch，没有采用总线结构，分成了事务层，数据链路层，物理层

### 附录6、串行总线

RS-232接口 485总线 I2C接口 SPI总线 USB总线

USB是一种支持热插拔的高速串行总线

### 附录7、输入输出设备

#### 知识点、21 外设概念和粗略分类

外存储器：硬盘，光驱，RAID，U盘；鼠标；键盘；显示器；打印机

鼠标：机械鼠标，光电鼠标

键盘：硬件扫描键盘，软件扫描键盘

显示器：CRT显示器（阴极射线管），LCD显示器（液晶），LED显示器（发光二极管）

分辨率是显示屏的宽和高的像素数

显示器适配器：VGA（视频图形阵列），DVI（数字视频接口），HDMI（高清多媒体接口），Display Port（高清数字接口）

打印机：点阵针式打印机，喷墨打印机，激光打印机（充电，感光，显影，转印，定影，消影）

### 附录8、微程序控制

#### 知识点22、微程序控制基本思想

把一条机器指令编写成一个微程序，每个微程序包含多个微指令，每条微指令对应一个或者多个微操作命令。
微指令用二进制表示，每一位表示一个微操作命令，每个微操作命令产生一个控制信号，1表示有效。执行一条机器指令的所有微指令就可已按照时序产生所控制的信号，从而完成指令所要求的功能。

微指令格式：微操作（控制信号）+下一条微指令地址

控制存储器CM：取指令周期微程序-间址周期微程序-中断周期微程序-对应xxx指令的微程序-对应yyy指令的微程序

微指令执行：取指阶段（执行取微指令程序）->执行阶段（执行指令的微程序）

MAR Memoey Address Register
MDR Memoey Data Register
IR Instruction Register

Ad(CMDR)->CMAR指取下一条微指令地址

### 附录9、数模转换

DAC ADC A:Analog D:Digital C:Converter

数模转换-输出电压值

模数转换-基于参考电压给出二进制数

